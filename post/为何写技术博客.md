1 引言
从上周开始一直在看周志明的 「深入理解Java虚拟机：JVM高级特性与最佳实践（第3版）」 ，好多年之前看过第二版的，绝对算的上是国内 JVM 领域的经典之作，值得多读几遍。

全书的开头就介绍了如何自己编译一次 JDK ，之前看书的时候直接跳过了，一直都没自己操作过，上周读到这里的时候突然萌生了实践的念头，说搞就搞。

首先我这次选用的 OpenJDK ，而不是 OracleJDK ， OracleJDK 会有一些独立的商业特性，而这些商业特性都不是开源的，所以只能选择 OpenJDK 。

在开始编译之前，我也查看了很多网上的资料，所有的资料都建议我在基于 Unix 的系统上进行编译，也就是 Linux 或者是 MacOS ，但我就是头铁，上周在 Windows10 上从早晨 9 点搞到 12 点也没搞定，所以我投降了。

由于囊中羞涩等原因，手头上也没有 Mac 电脑，只能把目光瞄向了 Linux 。

一般这种时候可供选择的发行版要么是 CentOS 要么是 Ubuntu ，后来偶然看到有人推荐国产的 Linux 桌面版 deepin ，然后在自己电脑上切了 128G 的空间出来做了个双系统，正好在试用这款操作系统的同时尝试下编译 OpenJDK 。

2 OpenJDK 源码
首先我使用的是 deepin20 社区版。

JVM 第一篇：编译 OpenJdk14 ，我行你也行

编译目标是 OpenJDK14 ，也是目前最新的 JDK 版本。

OpenJDK 的源码是使用 Mercurial 代码版本管理工具进行管理，可以直接从 Repository 中获取源码：

hg clone https://hg.openjdk.java.net/jdk/jdk14
COPY
但是这么干吧，在国内搞实在是太慢了，不做某些网络相关设置的话，等这个全都 clone 下来，基本上要一上午时间，所以不推荐这么干，可以直接访问代码仓库，使用 zip 下载的方式直接下载代码包。

直接访问 https://hg.openjdk.java.net/jdk/jdk14/ ，点击左边的 browse ，然后再点击左边的 zip 按钮进行下载，我这里取到的下载地址是：

https://hg.openjdk.java.net/jdk/jdk14/archive/6c954123ee8d.zip
COPY
不知道这个下载地址是否长期可用，先放着吧。

等这个 zip 压缩包下载完成后，我就完成第一步了，得到了 OpenJDK14 的源码包，在这个源码包下有一个 doc 的目录，里面有一个 building.html ，这个文件实际上编译的指导手册，当编译出现问题的时候可以去这个手册里面查找解决方案。

JVM 第一篇：编译 OpenJdk14 ，我行你也行

3 环境准备
编译 JDK14 需要一个叫做 BootJDK 的东西，这个其实就是目标 JDK 的上一个 JDK 版本，比如我们要编译 JDK14 ，那么本地就需要有一个 JDK13 的环境，所以第一件事情是在本地安装 JDK13 ，下载地址：

http://jdk.java.net/java-se-ri/13
COPY
下载完成后解压，修改环境变量的配置， deepin 系统的环境变量在用户目录的 .bashrc 中，因为我这个是桌面版的系统，直接使用 VSCode 在文件的最后配置上 JDK13 的环境变量：

export JAVA_HOME=/home/用户名/Java/jdk-13
export CLASSPATH=${JAVA_HOME}/lib
export PATH=${JAVA_HOME}/bin:$PATH
COPY
然后在命令行 terminal 中刷新一下这个配置文件：

source /home/用户名/.bashrc
COPY
这时输入经典的命令 java -version 看下版本信息：

openjdk version "13" 2019-09-17
OpenJDK Runtime Environment (build 13+33)
OpenJDK 64-Bit Server VM (build 13+33, mixed mode, sharing)
COPY
接着开始安装各种环境，为编译做准备，因为要装的软件属实有点多，我把命令整理出来都放在下面了：
